!function(t){var e={};function o(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=7)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=o(10);e.createDataTable=a.createDataTable;const n=o(11);e.defaultOptions=n.defaultOptions,e.getType=function(t){return Object.prototype.toString.call(t).slice(8,-1)},e.domLoaded=function(){return new Promise(t=>{"interactive"===document.readyState||"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",()=>t)})},e.addEvent=function(t,e,o,a=!1){null!=t&&(t.addEventListener?t.addEventListener(e,o,a):t.attachEvent?t.attachEvent("on"+e,o):t["on"+e]=o)}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a extends Error{constructor(t="There was an error"){super(t)}}e.LavaJsError=a;e.InvalidCallback=class extends a{constructor(t){super(`[lava.js] "${typeof t}" is not a valid callback.`)}};e.RenderableNotFound=class extends a{constructor(t){super(`[lava.js] A renderable with the label "${t}" was not found.`)}};e.DataError=class extends a{constructor(t){super(t)}};e.ElementIdNotFound=class extends a{constructor(t){super(`[lava.js] DOM node where id="${t}" was not found.`)}}},function(t,e,o){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=a(o(3));e.GoogleLoader=n.default;const r=a(o(8));e.LavaJs=r.default;const i=o(0);e.domLoaded=i.domLoaded},function(t,e,o){"use strict";var a=this&&this.__awaiter||function(t,e,o,a){return new(o||(o=Promise))((function(n,r){function i(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}l((a=a.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.options=t,this.API_VERSION="current",this.LOADER_URL="https://www.gstatic.com/charts/loader.js",this.packages=new Set}get isLoaded(){return void 0!==window.google}get googleLoaderInPage(){const t=document.getElementsByTagName("script");for(const e of Array.from(t))if(e.src===this.LOADER_URL)return!0;return!1}get config(){const t={language:this.options.locale||"en",packages:Array.from(this.packages)};return""!==this.options.mapsApiKey&&(t.mapsApiKey=this.options.mapsApiKey),t}addPackage(t){this.packages.add(t)}loadGoogle(){return a(this,void 0,void 0,(function*(){return console.log("[lava.js] Resolving Google..."),!1===this.googleLoaderInPage&&(console.log("[lava.js] Static loader not found, appending to head"),yield this.addGoogleScriptToHead()),new Promise(t=>{console.log("[lava.js] Static loader found, initializing window.google"),window.google.charts.load(this.API_VERSION,this.config),console.log("[lava.js] Loaded Google with config:",this.config),window.google.charts.setOnLoadCallback(()=>{t(window.google)})})}))}addGoogleScriptToHead(){return new Promise(t=>{const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=this.LOADER_URL,e.onload=e.onreadystatechange=o=>{("load"===(o=o||window.event).type||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,t())},document.head.appendChild(e)})}}},function(t,e){function o(){}o.prototype={on:function(t,e,o){var a=this.e||(this.e={});return(a[t]||(a[t]=[])).push({fn:e,ctx:o}),this},once:function(t,e,o){var a=this;function n(){a.off(t,n),e.apply(o,arguments)}return n._=e,this.on(t,n,o)},emit:function(t){for(var e=[].slice.call(arguments,1),o=((this.e||(this.e={}))[t]||[]).slice(),a=0,n=o.length;a<n;a++)o[a].fn.apply(o[a].ctx,e);return this},off:function(t,e){var o=this.e||(this.e={}),a=o[t],n=[];if(a&&e)for(var r=0,i=a.length;r<i;r++)a[r].fn!==e&&a[r].fn._!==e&&n.push(a[r]);return n.length?o[t]=n:delete o[t],this}},t.exports=o,t.exports.TinyEmitter=o},function(t,e,o){"use strict";var a=this&&this.__awaiter||function(t,e,o,a){return new(o||(o=Promise))((function(n,r){function i(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}l((a=a.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(4),i=n(o(6)),s=o(1),l=o(0),c=o(12);class u extends r.TinyEmitter{constructor(t){if(super(),this.type=t.type,this.label=t.label,this.dataSrc=t.data,this.elementId=t.elementId,this.container=document.getElementById(this.elementId),null===this.container)throw new Error(`document.getElementById("${this.elementId}") did not return an HTMLElement`);this.options=t.options||{},this.formats=t.formats||[],this.class=c.getProp(this.type,c.VIZ_PROPS.CLASS),this.package=c.getProp(this.type,c.VIZ_PROPS.PACKAGE)}get uuid(){return this.type+"::"+this.label}draw(){if("function"==typeof this._preDraw&&(console.log(`[lava.js] Running ${this.uuid}._preDraw()`),this._preDraw()),"function"==typeof this.preDraw&&(console.log(`[lava.js] Running ${this.uuid}.preDraw()`),this.preDraw()),!this.data)throw new s.DataError(`${this.uuid} Could not draw, data is ${this.data}`);this.googleChart.draw(this.data,this.options),"function"==typeof this._postDraw&&(console.log(`[lava.js] Running ${this.uuid}._postDraw()`),this._postDraw()),"function"==typeof this.postDraw&&(console.log(`[lava.js] Running ${this.uuid}.postDraw()`),this.postDraw())}run(){return a(this,void 0,void 0,(function*(){if(!this.container)throw new s.ElementIdNotFound(this.elementId);yield this.setData(this.dataSrc),this.formats&&this.applyFormats(),this.draw()}))}setData(t){return a(this,void 0,void 0,(function*(){if(t instanceof i.default){console.log(`[lava.js] Sending DataQuery for ${this.uuid}`);const e=yield t.send();console.log("[lava.js] Response received:",e),this.data=e.getDataTable()}else this.data=l.createDataTable(t);if(this.data instanceof google.visualization.DataTable==!1)throw new s.DataError(`There was a error setting the data for ${this.uuid}`);console.log(`[lava.js] Data set for ${this.uuid}`,this.data),t.formats&&this.applyFormats(t.formats)}))}applyFormats(t){t&&(this.formats=t);for(const t of this.formats){const e=new window.google.visualization[t.type](t.options);console.log(`[lava.js] Formatting data for ${this.uuid}.`),console.log(`[lava.js] Formatting column [${t.index}] with:`,t),e.format(this.data,t.index)}}}e.default=u},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=o(1);class n{constructor(t,e,o){this.url=t,this.opts={sendMethod:"auto"},this.transformer=t=>t,o&&(this.transformer=o),e&&(this.opts=e)}static create(t){if(!t.url)throw new a.DataError('"url" is a mandatory parameter for creating a DataQuery.');const e=new n(t.url);return"object"==typeof t.opts&&(e.opts=t.opts),"function"==typeof t.transformer&&(e.transformer=t.transformer),e}send(){const t=new window.google.visualization.Query(this.url,this.opts);return new Promise((e,o)=>{this.transformer(t).send(t=>{t.isError()&&o(t),e(t)})})}}e.default=n},function(t,e,o){"use strict";o.r(e);var a=o(2);window.lava=new a.LavaJs,void 0!==window.lavacharts&&window.lava.configure(window.lavacharts.options),window.lava.autorun&&Object(a.domLoaded)().then(()=>window.lava.run())},function(t,e,o){"use strict";var a=this&&this.__awaiter||function(t,e,o,a){return new(o||(o=Promise))((function(n,r){function i(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}l((a=a.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(4),i=n(o(9)),s=n(o(13)),l=n(o(6)),c=o(1),u=n(o(3)),d=o(0);class h extends r.TinyEmitter{constructor(t){super(),this.options=d.defaultOptions,this.volcano=new Map,t&&this.configure(t),this.loader=new u.default(this.options)}get autorun(){return void 0===this.options.autoRun||this.options.autoRun}configure(t){this.options=Object.assign(this.options,t)}init(t){return a(this,void 0,void 0,(function*(){console.log("[lava.js] Inititalizing..."),t&&(t instanceof Array&&t.forEach(this.store,this),"object"==typeof t&&this.store(t)),!1===this.loader.isLoaded&&(yield this.loader.loadGoogle())}))}run(){return a(this,void 0,void 0,(function*(){console.group(`[lava.js] v${h.VERSION}`),console.log("loaded options",this.options),this.attachRedrawHandler(),yield this.init(),console.log("google is ready",window.google),yield this.renderAll(),"function"==typeof this.readyCallback&&(console.log("ready!"),this.readyCallback()),console.groupEnd()}))}renderAll(){const t=[];return this.volcano.forEach(e=>{console.log(`[lava.js] Rendering ${e.uuid}`),t.push(e.run())}),t}query(t){return"string"==typeof t?new l.default(t):l.default.create(t)}create(t){return console.log(`[lava.js] Creating a new ${t.type}:`,t),"Dashboard"===t.type?new s.default(t):new i.default(t)}store(t){const e=this.create(t);console.log(`[lava.js] Storing ${e.uuid}`),this.loader.addPackage(e.package),this.volcano.set(e.label,e)}get(t=""){if(!1===this.volcano.has(t))throw new c.RenderableNotFound(t);return this.volcano.get(t)}ready(t){if("function"!=typeof t)throw new c.InvalidCallback(t);this.readyCallback=t.bind(this)}loadData(t,e){return a(this,void 0,void 0,(function*(){const o=this.get(t);return!!o&&(yield o.setData(e),o.draw(),{data:o.data,chart:o.googleChart,options:o.options})}))}loadOptions(t,e){return a(this,void 0,void 0,(function*(){const o=this.get(t);return!!o&&(o.options=Object.assign(o.options,e),o.draw(),{data:o.data,chart:o.googleChart,options:o.options})}))}redrawAll(){return 0===this.volcano.size?(console.log("[lava.js] Nothing to redraw."),!1):(console.log(`[lava.js] Redrawing ${this.volcano.size} renderables.`),this.volcano.forEach(t=>{console.log(`[lava.js] Redrawing ${t.uuid}`),t.draw()}),!0)}attachRedrawHandler(){if(!0===this.options.responsive){let t;d.addEvent(window,"resize",()=>{clearTimeout(t),t=setTimeout(()=>{console.log("[lava.js] Window re-sized, redrawing..."),this.redrawAll()},this.options.debounceTimeout)})}}}e.default=h,h.VERSION="4.0.0-beta3"},function(t,e,o){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=a(o(5));class r extends n.default{constructor(t){super(t),this.png=Boolean(t.png)}_preDraw(){const t=(e=this.container,t=>new window.google.visualization[t](e));var e;this.googleChart=t(this.class)}_postDraw(){this.png&&this.drawPng()}drawPng(){const t=document.createElement("img");t.src=this.googleChart.getImageURI(),this.container&&(this.container.innerHTML="",this.container.appendChild(t))}}e.default=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=o(0);e.createDataTable=function(t){return"Function"===a.getType(t)?t(new window.google.visualization.DataTable):"Array"===a.getType(t)?window.google.visualization.arrayToDataTable(t):"Function"===a.getType(t.getTableProperties)?t:"Array"===a.getType(t.data)?window.google.visualization.data.join(new window.google.visualization.DataTable(t.data[0]),new window.google.visualization.DataTable(t.data[1]),t.keys,t.joinMethod,t.dt1Columns,t.dt2Columns):("Object"===a.getType(t.data)&&(t=t.data),new window.google.visualization.DataTable(t))}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultOptions={autoRun:!0,datetimeFormat:"",debounceTimeout:250,locale:"en",mapsApiKey:"",responsive:!0,timezone:"America/Los_Angeles"}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.CLASS=0]="CLASS",t[t.PACKAGE=1]="PACKAGE",t[t.VERSION=2]="VERSION"}(e.VIZ_PROPS||(e.VIZ_PROPS={}));const a={AnnotationChart:["AnnotationChart","annotationchart",1],AreaChart:["AreaChart","corechart",1],BarChart:["BarChart","corechart",1],BubbleChart:["BubbleChart","corechart",1],CalendarChart:["Calendar","calendar",1],CandlestickChart:["CandlestickChart","corechart",1],ColumnChart:["ColumnChart","corechart",1],ComboChart:["ComboChart","corechart",1],DonutChart:["PieChart","corechart",1],GanttChart:["Gantt","gantt",1],GaugeChart:["Gauge","gauge",1],GeoChart:["GeoChart","geochart",1],HistogramChart:["Histogram","corechart",1],LineChart:["LineChart","corechart",1],PieChart:["PieChart","corechart",1],SankeyChart:["Sankey","sankey",1],ScatterChart:["ScatterChart","corechart",1],SteppedAreaChart:["SteppedAreaChart","corechart",1],TableChart:["Table","table",1],TimelineChart:["Timeline","timeline",1],TreeMapChart:["TreeMap","treemap",1],WordTreeChart:["WordTree","wordtree",1]};e.getProp=function(t,e){return a[t][e]}},function(t,e,o){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=a(o(5));class r extends n.default{constructor(t){t.type="Dashboard",super(t),this.googleChart=new window.google.visualization.Dashboard(this.container),this.bindings=t.bindings}}e.default=r}]);
//# sourceMappingURL=lava.js.map