!function(t){var e={};function a(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(o,n,function(e){return t[e]}.bind(null,n));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=7)}([function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=a(10);e.createDataTable=o.createDataTable;const n=a(11);e.defaultOptions=n.defaultOptions,e.getType=function(t){return Object.prototype.toString.call(t).slice(8,-1)},e.domLoaded=function(){return new Promise(t=>{"interactive"===document.readyState||"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",()=>t)})},e.addEvent=function(t,e,a,o=!1){null!=t&&(t.addEventListener?t.addEventListener(e,a,o):t.attachEvent?t.attachEvent("on"+e,a):t["on"+e]=a)}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class o extends Error{constructor(t="There was an error"){super(t)}}e.LavaJsError=o;e.InvalidCallback=class extends o{constructor(t){super(`[lava.js] "${typeof t}" is not a valid callback.`)}};e.RenderableNotFound=class extends o{constructor(t){super(`[lava.js] A renderable with the label "${t}" was not found.`)}};e.DataError=class extends o{constructor(t){super(t)}};e.ElementIdNotFound=class extends o{constructor(t){super(`[lava.js] DOM node where id="${t}" was not found.`)}}},function(t,e,a){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=o(a(3));e.GoogleLoader=n.default;const r=o(a(8));e.LavaJs=r.default;const s=a(0);e.domLoaded=s.domLoaded},function(t,e,a){"use strict";var o=this&&this.__awaiter||function(t,e,a,o){return new(a||(a=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function i(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,i)}l((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.options=t,this.API_VERSION="current",this.LOADER_URL="https://www.gstatic.com/charts/loader.js",this.packages=new Set}get isLoaded(){return void 0!==window.google}get googleLoaderInPage(){const t=document.getElementsByTagName("script");for(const e of Array.from(t))if(e.src===this.LOADER_URL)return!0;return!1}get config(){const t={language:this.options.locale||"en",packages:Array.from(this.packages)};return""!==this.options.mapsApiKey&&(t.mapsApiKey=this.options.mapsApiKey),t}addPackage(t){this.packages.add(t)}loadGoogle(){return o(this,void 0,void 0,(function*(){return console.log("[lava.js] Resolving Google..."),!1===this.googleLoaderInPage&&(console.log("[lava.js] Static loader not found, appending to head"),yield this.addGoogleScriptToHead()),new Promise(t=>{console.log("[lava.js] Static loader found, initializing window.google"),window.google.charts.load(this.API_VERSION,this.config),console.log("[lava.js] Loaded Google with config:",this.config),window.google.charts.setOnLoadCallback(()=>{t(window.google)})})}))}addGoogleScriptToHead(){return new Promise(t=>{const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=this.LOADER_URL,e.onload=e.onreadystatechange=a=>{("load"===(a=a||window.event).type||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,t())},document.head.appendChild(e)})}}},function(t,e){function a(){}a.prototype={on:function(t,e,a){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:a}),this},once:function(t,e,a){var o=this;function n(){o.off(t,n),e.apply(a,arguments)}return n._=e,this.on(t,n,a)},emit:function(t){for(var e=[].slice.call(arguments,1),a=((this.e||(this.e={}))[t]||[]).slice(),o=0,n=a.length;o<n;o++)a[o].fn.apply(a[o].ctx,e);return this},off:function(t,e){var a=this.e||(this.e={}),o=a[t],n=[];if(o&&e)for(var r=0,s=o.length;r<s;r++)o[r].fn!==e&&o[r].fn._!==e&&n.push(o[r]);return n.length?a[t]=n:delete a[t],this}},t.exports=a,t.exports.TinyEmitter=a},function(t,e,a){"use strict";var o=this&&this.__awaiter||function(t,e,a,o){return new(a||(a=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function i(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,i)}l((o=o.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=a(4),s=n(a(6)),i=a(1),l=a(0),c=n(a(12));class u extends r.TinyEmitter{constructor(t){if(super(),this.type=t.type,this.label=t.label,this.dataSrc=t.data,this.elementId=t.elementId,this.container=document.getElementById(this.elementId),null===this.container)throw new Error(`document.getElementById("${this.elementId}") did not return an HTMLElement`);this.options=t.options||{},this.formats=t.formats||[],this.class=c.default[this.type].class,this.package=c.default[this.type].package}get uuid(){return this.type+"::"+this.label}draw(){if("function"==typeof this._preDraw&&(console.log(`[lava.js] Running ${this.uuid}._preDraw()`),this._preDraw()),"function"==typeof this.preDraw&&(console.log(`[lava.js] Running ${this.uuid}.preDraw()`),this.preDraw()),!this.data)throw new i.DataError(`${this.uuid} Could not draw, data is ${this.data}`);this.googleChart.draw(this.data,this.options),"function"==typeof this._postDraw&&(console.log(`[lava.js] Running ${this.uuid}._postDraw()`),this._postDraw()),"function"==typeof this.postDraw&&(console.log(`[lava.js] Running ${this.uuid}.postDraw()`),this.postDraw())}run(){return o(this,void 0,void 0,(function*(){if(!this.container)throw new i.ElementIdNotFound(this.elementId);yield this.setData(this.dataSrc),this.formats&&this.applyFormats(),this.draw()}))}setData(t){return o(this,void 0,void 0,(function*(){if(t instanceof s.default){console.log(`[lava.js] Sending DataQuery for ${this.uuid}`);const e=yield t.send();console.log("[lava.js] Response received:",e),this.data=e.getDataTable()}else this.data=l.createDataTable(t);if(this.data instanceof google.visualization.DataTable==!1)throw new i.DataError(`There was a error setting the data for ${this.uuid}`);console.log(`[lava.js] Data set for ${this.uuid}`,this.data),t.formats&&this.applyFormats(t.formats)}))}applyFormats(t){t&&(this.formats=t);for(const t of this.formats){const e=new window.google.visualization[t.type](t.options);console.log(`[lava.js] Formatting data for ${this.uuid}.`),console.log(`[lava.js] Formatting column [${t.index}] with:`,t),e.format(this.data,t.index)}}}e.default=u},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=a(1);class n{constructor(t,e,a){this.url=t,this.opts={sendMethod:"auto"},this.transformer=t=>t,a&&(this.transformer=a),e&&(this.opts=e)}static create(t){if(!t.url)throw new o.DataError('"url" is a mandatory parameter for creating a DataQuery.');const e=new n(t.url);return"object"==typeof t.opts&&(e.opts=t.opts),"function"==typeof t.transformer&&(e.transformer=t.transformer),e}send(){const t=new window.google.visualization.Query(this.url,this.opts);return new Promise((e,a)=>{this.transformer(t).send(t=>{t.isError()&&a(t),e(t)})})}}e.default=n},function(t,e,a){"use strict";a.r(e);var o=a(2);window.lava=new o.LavaJs,void 0!==window.lavacharts&&window.lava.configure(window.lavacharts.options),window.lava.autorun&&Object(o.domLoaded)().then(()=>window.lava.run())},function(t,e,a){"use strict";var o=this&&this.__awaiter||function(t,e,a,o){return new(a||(a=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function i(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(s,i)}l((o=o.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=a(4),s=n(a(9)),i=n(a(13)),l=n(a(6)),c=a(1),u=n(a(3)),d=a(0);class h extends r.TinyEmitter{constructor(t){super(),this.options=d.defaultOptions,this.volcano=new Map,t&&this.configure(t),this.loader=new u.default(this.options)}get autorun(){return void 0===this.options.autoRun||this.options.autoRun}configure(t){this.options=Object.assign(this.options,t)}init(t){return o(this,void 0,void 0,(function*(){console.log("[lava.js] Inititalizing..."),t&&(t instanceof Array&&t.forEach(this.store,this),"object"==typeof t&&this.store(t)),!1===this.loader.isLoaded&&(yield this.loader.loadGoogle())}))}run(){return o(this,void 0,void 0,(function*(){console.group(`[lava.js] v${h.VERSION}`),console.log("loaded options",this.options),this.attachRedrawHandler(),yield this.init(),console.log("google is ready",window.google),yield this.renderAll(),"function"==typeof this.readyCallback&&(console.log("ready!"),this.readyCallback()),console.groupEnd()}))}renderAll(){const t=[];return this.volcano.forEach(e=>{console.log(`[lava.js] Rendering ${e.uuid}`),t.push(e.run())}),t}query(t){return"string"==typeof t?new l.default(t):l.default.create(t)}create(t){return console.log(`[lava.js] Creating a new ${t.type}:`,t),"Dashboard"===t.type?new i.default(t):new s.default(t)}store(t){const e=this.create(t);console.log(`[lava.js] Storing ${e.uuid}`),this.loader.addPackage(e.package),this.volcano.set(e.label,e)}get(t=""){if(!1===this.volcano.has(t))throw new c.RenderableNotFound(t);return this.volcano.get(t)}ready(t){if("function"!=typeof t)throw new c.InvalidCallback(t);this.readyCallback=t.bind(this)}loadData(t,e){return o(this,void 0,void 0,(function*(){const a=this.get(t);return!!a&&(yield a.setData(e),a.draw(),{data:a.data,chart:a.googleChart,options:a.options})}))}loadOptions(t,e){return o(this,void 0,void 0,(function*(){const a=this.get(t);return!!a&&(a.options=Object.assign(a.options,e),a.draw(),{data:a.data,chart:a.googleChart,options:a.options})}))}redrawAll(){return 0===this.volcano.size?(console.log("[lava.js] Nothing to redraw."),!1):(console.log(`[lava.js] Redrawing ${this.volcano.size} renderables.`),this.volcano.forEach(t=>{console.log(`[lava.js] Redrawing ${t.uuid}`),t.draw()}),!0)}attachRedrawHandler(){if(!0===this.options.responsive){let t;d.addEvent(window,"resize",()=>{clearTimeout(t),t=setTimeout(()=>{console.log("[lava.js] Window re-sized, redrawing..."),this.redrawAll()},this.options.debounceTimeout)})}}}e.default=h,h.VERSION="4.0.0-beta3"},function(t,e,a){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=o(a(5));class r extends n.default{constructor(t){super(t),this.png=Boolean(t.png)}_preDraw(){const t=(e=this.container,t=>new window.google.visualization[t](e));var e;this.googleChart=t(this.class)}_postDraw(){this.png&&this.drawPng()}drawPng(){const t=document.createElement("img");t.src=this.googleChart.getImageURI(),this.container&&(this.container.innerHTML="",this.container.appendChild(t))}}e.default=r},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=a(0);e.createDataTable=function(t){return"Function"===o.getType(t)?t(new window.google.visualization.DataTable):"Array"===o.getType(t)?window.google.visualization.arrayToDataTable(t):"Function"===o.getType(t.getTableProperties)?t:"Array"===o.getType(t.data)?window.google.visualization.data.join(new window.google.visualization.DataTable(t.data[0]),new window.google.visualization.DataTable(t.data[1]),t.keys,t.joinMethod,t.dt1Columns,t.dt2Columns):("Object"===o.getType(t.data)&&(t=t.data),new window.google.visualization.DataTable(t))}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultOptions={autoRun:!0,datetimeFormat:"",debounceTimeout:250,locale:"en",mapsApiKey:"",responsive:!0,timezone:"America/Los_Angeles"}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={AnnotationChart:{class:"AnnotationChart",package:"annotationchart",version:1},AreaChart:{class:"AreaChart",package:"corechart",version:1},BarChart:{class:"BarChart",package:"corechart",version:1},BubbleChart:{class:"BubbleChart",package:"corechart",version:1},CalendarChart:{class:"Calendar",package:"calendar",version:1.1},CandlestickChart:{class:"CandlestickChart",package:"corechart",version:1},ColumnChart:{class:"ColumnChart",package:"corechart",version:1},ComboChart:{class:"ComboChart",package:"corechart",version:1},DonutChart:{class:"PieChart",package:"corechart",version:1},GanttChart:{class:"Gantt",package:"gantt",version:1},GaugeChart:{class:"Gauge",package:"gauge",version:1},GeoChart:{class:"GeoChart",package:"geochart",version:1},HistogramChart:{class:"Histogram",package:"corechart",version:1},LineChart:{class:"LineChart",package:"corechart",version:1},PieChart:{class:"PieChart",package:"corechart",version:1},SankeyChart:{class:"Sankey",package:"sankey",version:1},ScatterChart:{class:"ScatterChart",package:"corechart",version:1},SteppedAreaChart:{class:"SteppedAreaChart",package:"corechart",version:1},TableChart:{class:"Table",package:"table",version:1},TimelineChart:{class:"Timeline",package:"timeline",version:1},TreeMapChart:{class:"TreeMap",package:"treemap",version:1},WordTreeChart:{class:"WordTree",package:"wordtree",version:1}}},function(t,e,a){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=o(a(5));class r extends n.default{constructor(t){t.type="Dashboard",super(t),this.googleChart=new window.google.visualization.Dashboard(this.container),this.bindings=t.bindings}}e.default=r}]);
//# sourceMappingURL=lava.js.map